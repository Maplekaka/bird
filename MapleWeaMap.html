<!DOCTYPE html>
<html>
<head>
  <!--  <link rel="stylesheet" type="text/css" href="main.css"> -->

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>IADProJect2_Maple</title>
    <style type="text/css">
        html{height:100%}
        body{height:100%;background-color: azure}
        #container{}
        #user{float: right;}
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=RLegS6GllGVFnmOntODeKW0OzG8oUP6d"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
</head>

<body>
<table>
    <tr style="background-color: burlywood;">
        <div id="user" style="width: 400px;height: 100%;float: right;display: inline-block">
            <div id="search">
                <h1 style="font-family: Calibri;color:#ff4400">Maple的天气地图</h1>
                <input type="text" id="inp" placeholder="请输入地名，点击地图上的角标可获得当地天气信息" style="width: 400px;height: 50px">
            <!--    <button id="but" onclick="ChooseCity()" width="50px" height="20px">确认</button> -->
            <!--      <button id="wea" onclick="wea()" width="50px" height="20px">显示天气信息</button> -->
            </div>
            <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
            
            <button id="returnToHomePage" style="margin-top: 490px; width: 160px; height: 40px; background-color:antiquewhite; text-align: center;color:#ff4400; margin-left: 100px; " type="button" onclick="location.href='https://maplekaka.github.io/bird'" >Return Back To Home</button>
            <img style="height: 50px; padding-top: 10px;" src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3612625395,3492715870&fm=26&gp=0.jpg">
        </div>
    </tr>
    <tr>
        <div id="container" style="height:100%;width: 90%; float: left;display: inline-block"></div>
    </tr>
</table>



<script>
    city_name = "广州";
    
    function ChooseCity() {
        city_name = document.getElementById("inp").value;
        map.centerAndZoom(city_name);
    }
    var map = new BMap.Map("container"); // 创建地图实例
    var point = new BMap.Point(116.417854,39.921988);// 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); //开启滚轮缩放地图
    map.centerAndZoom(point, 12);// 百度地图API功能

    function G(id) {
        return document.getElementById(id);
    }

    var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
        {"input" : "inp"
            ,"location" : map
        });

    ac.addEventListener("onhighlight", function(e) {  //鼠标放在下拉列表上的事件
        var str = "";
        var _value = e.fromitem.value;
        var value = "";
        if (e.fromitem.index > -1) {
            value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
        }
        str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

        value = "";
        if (e.toitem.index > -1) {
            _value = e.toitem.value;
            value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
        }
        str += "<br />ToItem<br />index = " + e.toitem.ind.ex + "<br />value = " + value;
        G("searchResultPanel").innerHTML = str;
    });

    var myValue;
    var City;
    ac.addEventListener("onconfirm", function(e) {    //鼠标点击下拉列表后的事件
        var _value = e.item.value;
        City = _value.city.slice(0,-1);
        myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
        G("searchResultPanel").innerHTML ="onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;

        setPlace();
    });

    function setPlace(){
        map.clearOverlays();    //清除地图上所有覆盖物
        function myFun(){
            var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
            map.centerAndZoom(pp, 18);
            newmark = new BMap.Marker(pp);
            map.addOverlay(newmark);    //
            var opts = {
                width : 200,     // 信息窗口宽度
                height: 140,     // 信息窗口高度
                title : myValue , // 信息窗口标题
                enableMessage:true,//设置允许信息窗发送短息
            }
            newmark.addEventListener("click", function(){
                var weaDetail;
                $.ajax({
                    type: 'GET',
                    url:'https://www.tianqiapi.com/api/',
                    data:"version=v1&city="+City+"&appid=[96165544]&appsecret=[g7gnrkHU]",
                    dataType:"JSON",
                    error: function () {
                        alert("error!");
                    },
                    success: function (res) {
                        console.log(res);
                        var weahtml;
                        if (res["data"][0]["wea_img"] == 'lei'){
                            weahtml = "<img src ='lei.png'>";
                        }else if (res["data"][0]["wea_img"] == 'qing'){
                            weahtml = "<img src ='qing.png'>";
                        }else if(res["data"][0]["wea_img"] == 'shachen'){
                            weahtml = "<img src ='shachen.png'>";
                        }else if(res["data"][0]["wea_img"] == 'wu'){
                            weahtml = "<img src ='wu.png'>";
                        }else if(res["data"][0]["wea_img"] == 'xue'){
                            weahtml = "<img src ='xue.png'>";
                        }else if(res["data"][0]["wea_img"] == 'yin'){
                            weahtml = "<img src ='yin.png'>";
                        }else if(res["data"][0]["wea_img"] == 'yu'){
                            weahtml = "<img src ='yu.png'>";
                        }else if(res["data"][0]["wea_img"] == 'yujiaxue'){
                            weahtml = "<img src ='yujiaxue.png'>";
                        }else if(res["data"][0]["wea_img"] == 'yun'){
                            weahtml = "<img src ='yun.png'>";
                        }
                        var weatherText =
                            "<div> 气温："+res["data"][0]["tem2"]
                            +"~"+res["data"][0]["tem1"]+"</div>"+
                            "<div> 天气："+res["data"][0]["wea"]+weahtml+"</div>"
                            +" <div>时期："+ res["data"][0]["day"]+"</div>"
                            +" <div>穿衣推荐：" +res["data"][0]["index"][3]["desc"]+"</div>";
                        var infoWindow = new BMap.InfoWindow(weatherText, opts);  // 创建信息窗口对象
                        map.openInfoWindow(infoWindow,pp); //开启信息窗口
                    }
                })

            });
        }
        var local = new BMap.LocalSearch(map, { //智能搜索
            onSearchComplete: myFun
        });
        local.search(myValue);
    }
</script>
</body>
</html>


